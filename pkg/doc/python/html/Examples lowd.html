

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Examples for the low-dimensional package &mdash; FFPopSim 1.1 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '1.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="FFPopSim 1.1 documentation" href="index.html" />
    <link rel="up" title="First steps with FFPopSim" href="First steps with FFPopSim.html" />
    <link rel="next" title="Examples for the high-dimensional package" href="Examples highd.html" />
    <link rel="prev" title="First steps with FFPopSim" href="First steps with FFPopSim.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Examples highd.html" title="Examples for the high-dimensional package"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="First steps with FFPopSim.html" title="First steps with FFPopSim"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">FFPopSim 1.1 documentation</a> &raquo;</li>
          <li><a href="First steps with FFPopSim.html" accesskey="U">First steps with FFPopSim</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="examples-for-the-low-dimensional-package">
<span id="examples-lowd"></span><h1><a class="toc-backref" href="#id1">Examples for the low-dimensional package</a><a class="headerlink" href="#examples-for-the-low-dimensional-package" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="table-of-contents">
<p class="topic-title first"><cite>Table of contents</cite></p>
<ul class="simple">
<li><a class="reference internal" href="#examples-for-the-low-dimensional-package" id="id1">Examples for the low-dimensional package</a><ul>
<li><a class="reference internal" href="#decay-of-linkage-disequilibrium" id="id2">Decay of linkage disequilibrium</a></li>
<li><a class="reference internal" href="#time-complexity-and-scaling" id="id3">Time complexity and scaling</a></li>
<li><a class="reference internal" href="#valley-crossing" id="id4">Valley Crossing</a></li>
</ul>
</li>
</ul>
</div>
<p>Various usage examples of the low-dimensional simulation package follow. Please note that they are sorted by increasing complexity.</p>
<div class="section" id="decay-of-linkage-disequilibrium">
<h2><a class="toc-backref" href="#id2">Decay of linkage disequilibrium</a><a class="headerlink" href="#decay-of-linkage-disequilibrium" title="Permalink to this headline">¶</a></h2>
<p>In recombining populations, genetic linkage decays with time. This
script initializes a population with high linkage disequilibrium (LD) and tracks how LD. The example can be found in <tt class="docutils literal"><span class="pre">decay_of_LD.py</span></tt>.</p>
<p>First, we load the FFPopSim module, along with the number crunching and plotting tools:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">FFPopSim</span> <span class="kn">as</span> <span class="nn">h</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">you might need to add the directory of the <tt class="docutils literal"><span class="pre">FFPopSim.py</span></tt>
file to your Python <tt class="docutils literal"><span class="pre">PATH</span></tt> for this to work. If you decide to copy
the library to a different destination instead, please make sure that
<tt class="docutils literal"><span class="pre">FFPopSim.py</span></tt> and <tt class="docutils literal"><span class="pre">_FFPopSim.so</span></tt> always are in the same folder.</p>
</div>
<p>Next, we set up the population:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># specify parameters</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">500000</span>                          <span class="c"># Population size</span>
<span class="n">L</span> <span class="o">=</span> <span class="mi">4</span>                               <span class="c"># number of loci</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">0.0</span>                            <span class="c"># no new mutations</span>
<span class="n">r</span> <span class="o">=</span> <span class="mf">0.01</span>                            <span class="c"># recombination rate</span>

<span class="c">### set up</span>
<span class="n">pop</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">haploid_lowd</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>             <span class="c"># produce an instance of haploid_lowd with L loci</span>
<span class="n">pop</span><span class="o">.</span><span class="n">carrying_capacity</span> <span class="o">=</span> <span class="n">N</span>           <span class="c"># set the steady-state population size</span>
<span class="n">pop</span><span class="o">.</span><span class="n">set_recombination_rates</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>      <span class="c"># assign the recombination rates</span>
<span class="n">pop</span><span class="o">.</span><span class="n">set_mutation_rates</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>          <span class="c"># assign the mutation rate</span>

<span class="c"># initialize the population with N/2 individuals with genotypes 0, that is ----</span>
<span class="c"># and N/2 with the opposite genotype 2**L -1, that is ++++</span>
<span class="n">pop</span><span class="o">.</span><span class="n">set_genotypes</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="n">L</span><span class="o">-</span><span class="mi">1</span><span class="p">],[</span><span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
<p>Third, we let the population evolve and we track linkage disequilibrium via the <tt class="docutils literal"><span class="pre">get_LD</span></tt> function:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">max_gen</span> <span class="o">=</span> <span class="mi">50</span>
<span class="c">#get LD for locus pairs (0,1), (0,2) and (0,3)</span>
<span class="n">LD_trajectories</span> <span class="o">=</span> <span class="p">[[</span><span class="n">pop</span><span class="o">.</span><span class="n">generation</span><span class="p">,</span><span class="n">pop</span><span class="o">.</span><span class="n">get_LD</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">pop</span><span class="o">.</span><span class="n">get_LD</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">pop</span><span class="o">.</span><span class="n">get_LD</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)]]</span>
<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_gen</span><span class="p">):</span>
    <span class="n">pop</span><span class="o">.</span><span class="n">evolve</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>               <span class="c">#evolve 5 generations</span>
    <span class="c">#get a new set of LD values</span>
    <span class="n">LD_trajectories</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pop</span><span class="o">.</span><span class="n">generation</span><span class="p">,</span> <span class="n">pop</span><span class="o">.</span><span class="n">get_LD</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">pop</span><span class="o">.</span><span class="n">get_LD</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span> <span class="n">pop</span><span class="o">.</span><span class="n">get_LD</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)])</span>
<span class="n">LD_trajectories</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">LD_trajectories</span><span class="p">)</span>      <span class="c">#cast to an array for plotting</span>
</pre></div>
</div>
<p>Fourth, we plot the resulting linkage disequilibrium curves:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">LD_trajectories</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="c">#plot the LD from simulations and compare it to the exponential decay expected from theory</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">LD_trajectories</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">LD_trajectories</span><span class="p">[:,</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">cols</span><span class="p">[</span><span class="n">ii</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s">r&#39;$D_{1&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;}$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">LD_trajectories</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.25</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">LD_trajectories</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span> <span class="n">r</span> <span class="o">*</span> <span class="p">(</span><span class="n">ii</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span> <span class="n">ls</span><span class="o">=</span><span class="s">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cols</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;Time [generations]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;LD $D_{ij}$&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>As expected, LD decays faster if loci are further apart. The typical
plot we obtain is the following and shows complete concordance of
theory and simulations:</p>
<img alt="_images/decay_of_LD.png" src="_images/decay_of_LD.png" />
</div>
<div class="section" id="time-complexity-and-scaling">
<h2><a class="toc-backref" href="#id3">Time complexity and scaling</a><a class="headerlink" href="#time-complexity-and-scaling" title="Permalink to this headline">¶</a></h2>
<p>Recombination is implemented in <tt class="docutils literal"><span class="pre">haploid_lowd</span></tt> in such a way that it scales with the number of loci as
<span class="math">\(\mathcal{O}(3^L)\)</span> instead of the naive <span class="math">\(\mathcal{O}(8^L)\)</span>. Moreover, if a single crossover
event is allowed to happen, the complexity is reduced even further to <span class="math">\(\mathcal{O}(L^2 \cdot 2^L)\)</span>.
This is shown in this example, called <tt class="docutils literal"><span class="pre">speed_lowd.py</span></tt>.</p>
<p>First, modules and paths are imported as usual, plus the <tt class="docutils literal"><span class="pre">time</span></tt> module is imported as well:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">time</span>
</pre></div>
</div>
<p>Second, population parameters are set:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span>                        <span class="c"># Population size</span>
<span class="n">Lmax</span> <span class="o">=</span> <span class="mi">12</span>                        <span class="c"># Maimal number of loci</span>
<span class="n">r</span> <span class="o">=</span> <span class="mf">0.01</span>                        <span class="c"># Recombination rate</span>
<span class="n">mu</span> <span class="o">=</span> <span class="mf">0.001</span>                      <span class="c"># Mutation rate</span>
<span class="n">G</span> <span class="o">=</span> <span class="mi">1000</span>                        <span class="c"># Generations</span>
</pre></div>
</div>
<p>Third, simulations of <tt class="docutils literal"><span class="pre">G</span></tt> generations are repeated for various number of loci <tt class="docutils literal"><span class="pre">L</span></tt>, to show the scaling behaviour of the recombination algorithm:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">exec_time</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">L</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">Lmax</span><span class="p">):</span>
    <span class="n">t1</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="c">### set up</span>
    <span class="n">pop</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">haploid_lowd</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>     <span class="c"># produce an instance of haploid_lowd with L loci</span>
    <span class="n">pop</span><span class="o">.</span><span class="n">carrying_capacity</span> <span class="o">=</span> <span class="n">N</span>   <span class="c"># set the population size</span>

    <span class="c"># set and additive fitness function. Note that FFPopSim models fitness landscape</span>
    <span class="n">pop</span><span class="o">.</span><span class="n">set_fitness_additive</span><span class="p">(</span><span class="mf">0.01</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">L</span><span class="p">))</span>

    <span class="n">pop</span><span class="o">.</span><span class="n">set_recombination_rates</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>  <span class="c"># assign the recombination rates</span>
    <span class="n">pop</span><span class="o">.</span><span class="n">set_mutation_rates</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>  <span class="c"># assign the mutation rate</span>

    <span class="c">#initialize the population with N individuals with genotypes 0, that is ----</span>
    <span class="n">pop</span><span class="o">.</span><span class="n">set_allele_frequencies</span><span class="p">(</span><span class="mf">0.2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">L</span><span class="p">),</span> <span class="n">N</span><span class="p">)</span>

    <span class="n">pop</span><span class="o">.</span><span class="n">evolve</span><span class="p">(</span><span class="n">G</span><span class="p">)</span>               <span class="c"># run for G generations</span>

    <span class="n">t2</span><span class="o">=</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="n">exec_time</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">L</span><span class="p">,</span> <span class="n">t2</span><span class="o">-</span><span class="n">t1</span><span class="p">])</span>    <span class="c"># store the execution time</span>

<span class="n">exec_time</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">exec_time</span><span class="p">)</span>
</pre></div>
</div>
<p>Fourth, the same schedule is repeated with a simpler recombination model, in which only one crossover is allowed,
setting the recombination rates with the optional argument <tt class="docutils literal"><span class="pre">pop.set_recombination_rates(r,</span> <span class="pre">h.SINGLE_CROSSOVER)</span></tt>,
and without recombination, using <tt class="docutils literal"><span class="pre">haploid_lowd.evolve_norec</span></tt> instead of the <tt class="docutils literal"><span class="pre">haploid_lowd.evolve</span></tt>.</p>
<p>Fifth, the time required is plotted agains the number of loci and
compared to the expectation <span class="math">\(\mathcal{O}(3^L)\)</span>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">exec_time</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">exec_time</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;with recombination&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;o&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">exec_time</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">exec_time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">3.0</span><span class="o">**</span><span class="p">(</span><span class="n">Lmax</span><span class="o">-</span><span class="n">exec_time</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s">r&#39;$\propto 3^L$&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">exec_time_norec</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">exec_time_norec</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span><span class="n">label</span><span class="o">=</span><span class="s">&#39;without recombination&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s">&#39;None&#39;</span><span class="p">,</span> <span class="n">marker</span> <span class="o">=</span> <span class="s">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">exec_time</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">exec_time_norec</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">2.0</span><span class="o">**</span><span class="p">(</span><span class="n">Lmax</span><span class="o">-</span><span class="n">exec_time_norec</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="s">r&#39;$\propto 2^L$&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">exec_time</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">exec_time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="mf">3.0</span><span class="o">**</span><span class="p">(</span><span class="n">Lmax</span><span class="p">)</span><span class="o">*</span><span class="mi">8</span><span class="o">**</span><span class="p">(</span><span class="n">exec_time</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]),</span><span class="n">label</span><span class="o">=</span><span class="s">r&#39;$\propto 8^L$&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;number of loci&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;seconds for &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">G</span><span class="p">)</span><span class="o">+</span><span class="s">&#39; generations&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="n">Lmax</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mf">0.2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">exec_time_norec</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]),</span><span class="mi">10</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">exec_time</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>The result confirm the theoretical expectation:</p>
<img alt="_images/speed_lowd.png" src="_images/speed_lowd.png" />
</div>
<div class="section" id="valley-crossing">
<h2><a class="toc-backref" href="#id4">Valley Crossing</a><a class="headerlink" href="#valley-crossing" title="Permalink to this headline">¶</a></h2>
<p>Now, something slightly more advanced. If sign epistasis is at work in
a certain populaiton, the fitness landscape will include
valleys. Those valleys need to be crossed by some individual carrying
multiple mutations in order to reach the fitness
maximum. Recombination can accelerate this process as a source of genetic diversity (in addition to random mutation). This works up to a certain point, where recombination becomes so frequent that it actually destroys beneficial combinations of mutations more often than it creates them. This phenomenon is simulated in this example, which can be found integrally in <tt class="docutils literal"><span class="pre">valley.py</span></tt>.</p>
<p>First, we load the usual modules, and we set the population parameters:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">L</span> <span class="o">=</span> <span class="mi">4</span>                           <span class="c"># Number of loci</span>
<span class="n">N</span> <span class="o">=</span> <span class="mf">1e10</span>                        <span class="c"># Population size</span>
<span class="n">s1</span> <span class="o">=</span> <span class="mf">1e-5</span>                       <span class="c"># Fitness of wildtype</span>
<span class="n">s2</span> <span class="o">=</span> <span class="mf">0.01</span>                       <span class="c"># Fitness of quadruple mutant</span>
</pre></div>
</div>
<p>Second, we decide what recombination and mutation rates to explore:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">rs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="o">+</span> \
     <span class="p">[</span><span class="mf">0.00125</span><span class="p">,</span> <span class="mf">0.0015</span><span class="p">,</span> <span class="mf">0.00175</span><span class="p">,</span> <span class="mf">0.002</span><span class="p">,</span>\
      <span class="mf">0.00225</span><span class="p">,</span> <span class="mf">0.0025</span><span class="p">,</span> <span class="mf">0.00275</span><span class="p">,</span> <span class="mf">0.003</span><span class="p">,</span>\
      <span class="mf">0.0031</span><span class="p">,</span> <span class="mf">0.0032</span><span class="p">,</span> <span class="mf">0.0033</span><span class="p">,</span> <span class="mf">0.0034</span><span class="p">,</span> \
      <span class="mf">0.0035</span><span class="p">,</span> <span class="mf">0.00375</span><span class="p">,</span> <span class="mf">0.004</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> \
      <span class="mf">0.0075</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>

<span class="n">mutation_rates</span><span class="o">=</span><span class="p">[</span><span class="mf">1e-7</span><span class="p">,</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">]</span>
</pre></div>
</div>
<p>Third, we prepare the figure for later:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Prepare figure</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">lstyles</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
           <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span>
           <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">]]</span>
<span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="s">&#39;g&#39;</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">,</span> <span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="s">&#39;c&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Fourth, we repeat the simulation for various mutation and recombination rates:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">mu</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mutation_rates</span><span class="p">):</span>
    <span class="p">[</span><span class="o">...</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rs</span><span class="p">):</span>
        <span class="p">[</span><span class="o">...</span><span class="p">]</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">haploid_lowd</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>             <span class="c">#produce population with L loci</span>
        <span class="n">c</span><span class="o">.</span><span class="n">set_genotypes</span><span class="p">([</span><span class="mi">0</span><span class="p">],[</span><span class="n">N</span><span class="p">])</span>          <span class="c">#initialize with N individuals in genotype 0 (wildtype)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">set_recombination_rates</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>   <span class="c">#set the recombination rate</span>
        <span class="n">c</span><span class="o">.</span><span class="n">set_mutation_rates</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>
        <span class="c">#set the wildtype fitness to s1 and the quadruple mutant fitness to s1+s2 (all other genotype have relative fitness 0)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">set_fitness_function</span><span class="p">([</span><span class="mi">0</span><span class="n">b0</span><span class="p">,</span> <span class="mi">0</span><span class="n">b1111</span><span class="p">],</span> <span class="p">[</span><span class="n">s1</span><span class="p">,</span> <span class="n">s1</span><span class="o">+</span><span class="n">s2</span><span class="p">])</span>

        <span class="c"># cross valley: evolve for gens generations at a time until quadruple mutant is at frequency &gt;1/2</span>
        <span class="n">gens</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="k">while</span> <span class="n">c</span><span class="o">.</span><span class="n">get_genotype_frequency</span><span class="p">(</span><span class="mi">0</span><span class="n">b1111</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.5</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">generation</span><span class="o">&lt;</span><span class="mf">1e6</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">evolve</span><span class="p">(</span><span class="n">gens</span><span class="p">)</span>
</pre></div>
</div>
<p>Fifth, we plot all lines:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">line</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">dtimes</span><span class="p">,</span>
            <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">k</span><span class="p">],</span>
            <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s">r&#39;$\mu=10^{&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mu</span><span class="p">)))</span><span class="o">+</span><span class="s">&#39;}$&#39;</span><span class="p">)</span>
<span class="n">line</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_dashes</span><span class="p">(</span><span class="n">lstyles</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
</pre></div>
</div>
<p>Finally, we complete the image:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">r&#39;Population size $N=10^{&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">N</span><span class="p">)))</span><span class="o">+</span><span class="s">&#39;}$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">r&#39;r [gen$^{-1}$]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">r&#39;crossing time [gen]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Time for valley crossing&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p>We obtain the following plot (note that the calculation takes a while):</p>
<img alt="_images/valley_crossing.png" src="_images/valley_crossing.png" />
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Examples for the low-dimensional package</a><ul>
<li><a class="reference internal" href="#decay-of-linkage-disequilibrium">Decay of linkage disequilibrium</a></li>
<li><a class="reference internal" href="#time-complexity-and-scaling">Time complexity and scaling</a></li>
<li><a class="reference internal" href="#valley-crossing">Valley Crossing</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="First steps with FFPopSim.html"
                        title="previous chapter">First steps with FFPopSim</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="Examples highd.html"
                        title="next chapter">Examples for the high-dimensional package</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/Examples lowd.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Examples highd.html" title="Examples for the high-dimensional package"
             >next</a> |</li>
        <li class="right" >
          <a href="First steps with FFPopSim.html" title="First steps with FFPopSim"
             >previous</a> |</li>
        <li><a href="index.html">FFPopSim 1.1 documentation</a> &raquo;</li>
          <li><a href="First steps with FFPopSim.html" >First steps with FFPopSim</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Fabio Zanini, Richard Neher.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>