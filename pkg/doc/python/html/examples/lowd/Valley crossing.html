

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Valley Crossing &mdash; FFPopSim 1.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="FFPopSim 1.1 documentation" href="../../index.html" />
    <link rel="up" title="First steps with FFPopSim" href="../../First steps with FFPopSim.html" />
    <link rel="next" title="Fitness wave" href="Fitness wave.html" />
    <link rel="prev" title="Time complexity and scaling" href="Time complexity and scaling.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Fitness wave.html" title="Fitness wave"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="Time complexity and scaling.html" title="Time complexity and scaling"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">FFPopSim 1.1 documentation</a> &raquo;</li>
          <li><a href="../../First steps with FFPopSim.html" accesskey="U">First steps with FFPopSim</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="valley-crossing">
<h1>Valley Crossing<a class="headerlink" href="#valley-crossing" title="Permalink to this headline">Â¶</a></h1>
<p>Now, something slightly more advanced. If sign epistasis is at work in a certain
populaiton, the fitness landscape will include valleys. Those valleys need to be
crossed by some individual carrying multiple mutations in order to reach the
fitness maximum. Recombination can accelerate this process as a source of
genetic diversity (in addition to random mutation).  This works up to a certain
point, where recombination becomes so frequent that it actually destroys
beneficial combinations of mutations more often than it creates them.  This
phenomenon is simulated in this example, which can be found integrally in
<tt class="docutils literal"><span class="pre">valley.py</span></tt>.</p>
<p>First, we load the usual modules, and we set the population parameters:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">L</span> <span class="o">=</span> <span class="mi">4</span>                           <span class="c"># Number of loci</span>
<span class="n">N</span> <span class="o">=</span> <span class="mf">1e10</span>                        <span class="c"># Population size</span>
<span class="n">s1</span> <span class="o">=</span> <span class="mf">1e-5</span>                       <span class="c"># Fitness of wildtype</span>
<span class="n">s2</span> <span class="o">=</span> <span class="mf">0.01</span>                       <span class="c"># Fitness of quadruple mutant</span>
</pre></div>
</div>
<p>Then, we decide what recombination and mutation rates to explore:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">rs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">,</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span> <span class="o">+</span> \
     <span class="p">[</span><span class="mf">0.00125</span><span class="p">,</span> <span class="mf">0.0015</span><span class="p">,</span> <span class="mf">0.00175</span><span class="p">,</span> <span class="mf">0.002</span><span class="p">,</span>
      <span class="mf">0.00225</span><span class="p">,</span> <span class="mf">0.0025</span><span class="p">,</span> <span class="mf">0.00275</span><span class="p">,</span> <span class="mf">0.003</span><span class="p">,</span>
      <span class="mf">0.0031</span><span class="p">,</span> <span class="mf">0.0032</span><span class="p">,</span> <span class="mf">0.0033</span><span class="p">,</span> <span class="mf">0.0034</span><span class="p">,</span>
      <span class="mf">0.0035</span><span class="p">,</span> <span class="mf">0.00375</span><span class="p">,</span> <span class="mf">0.004</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span>
      <span class="mf">0.0075</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>

<span class="n">mutation_rates</span><span class="o">=</span><span class="p">[</span><span class="mf">1e-7</span><span class="p">,</span><span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">]</span>
</pre></div>
</div>
<p>We then repeat the simulation for various mutation and recombination rates:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">mu</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mutation_rates</span><span class="p">):</span>
    <span class="p">[</span><span class="o">...</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rs</span><span class="p">):</span>
        <span class="p">[</span><span class="o">...</span><span class="p">]</span>

        <span class="n">c</span> <span class="o">=</span> <span class="n">h</span><span class="o">.</span><span class="n">haploid_lowd</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>               <span class="c"># produce population with L loci</span>
        <span class="n">c</span><span class="o">.</span><span class="n">set_genotypes</span><span class="p">([</span><span class="mi">0</span><span class="p">],[</span><span class="n">N</span><span class="p">])</span>            <span class="c"># initialize with N individuals in genotype 0 (wildtype)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">set_recombination_rates</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>        <span class="c"># set the recombination rate</span>
        <span class="n">c</span><span class="o">.</span><span class="n">set_mutation_rates</span><span class="p">(</span><span class="n">mu</span><span class="p">)</span>

        <span class="c">#set the wildtype fitness to s1 and the quadruple mutant fitness to s1+s2 (all other genotype have relative fitness 0)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">set_fitness_function</span><span class="p">([</span><span class="mi">0</span><span class="n">b0</span><span class="p">,</span> <span class="mi">0</span><span class="n">b1111</span><span class="p">],</span> <span class="p">[</span><span class="n">s1</span><span class="p">,</span> <span class="n">s1</span><span class="o">+</span><span class="n">s2</span><span class="p">])</span>

        <span class="c"># cross valley: evolve for gens generations at a time until quadruple mutant is at frequency &gt;1/2</span>
        <span class="n">gens</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="k">while</span> <span class="n">c</span><span class="o">.</span><span class="n">get_genotype_frequency</span><span class="p">(</span><span class="mi">0</span><span class="n">b1111</span><span class="p">)</span><span class="o">&lt;</span><span class="mf">0.5</span> <span class="ow">and</span> <span class="n">c</span><span class="o">.</span><span class="n">generation</span><span class="o">&lt;</span><span class="mf">1e6</span><span class="p">:</span>
            <span class="n">c</span><span class="o">.</span><span class="n">evolve</span><span class="p">(</span><span class="n">gens</span><span class="p">)</span>
</pre></div>
</div>
<p>Finally, we plot all lines with error bars:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ax</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">rs</span><span class="p">,</span> <span class="n">times</span><span class="p">,</span> <span class="n">dtimes</span><span class="p">,</span>
            <span class="n">c</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">k</span><span class="p">],</span>
            <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s">r&#39;$\mu=10^{&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">mu</span><span class="p">)))</span><span class="o">+</span><span class="s">&#39;}$&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>We obtain the following plot (note that the calculation takes a while):</p>
<img alt="../../_images/valley_crossing.png" src="../../_images/valley_crossing.png" />
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="Time complexity and scaling.html"
                        title="previous chapter">Time complexity and scaling</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="Fitness wave.html"
                        title="next chapter">Fitness wave</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/examples/lowd/Valley crossing.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="Fitness wave.html" title="Fitness wave"
             >next</a> |</li>
        <li class="right" >
          <a href="Time complexity and scaling.html" title="Time complexity and scaling"
             >previous</a> |</li>
        <li><a href="../../index.html">FFPopSim 1.1 documentation</a> &raquo;</li>
          <li><a href="../../First steps with FFPopSim.html" >First steps with FFPopSim</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Fabio Zanini, Richard Neher.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>